<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Counter</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/odometer/0.4.8/odometer.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/odometer/0.4.8/odometer-theme-default.min.css">
</head>
<body>
  <div class="counter-container" id="view-container">
    <div class="counter-label">Cherry On Top</div>
    <div class="live_view_count"></div>
  </div>
  <div class="counter-container" id="sub-container">
    <div class="counter-label">Salamin</div>
    <div class="live_sub_count"></div>
  </div>
  <div class="counter-container" id="third-container">
    <div class="counter-label">Pantropiko</div>
    <div class="live_third_count"></div>
  </div>
  <div class="counter-container" id="fourth-container">
    <div class="counter-label">Karera</div>
    <div class="live_karera_count"></div>
  </div>
  <div class="counter-container" id="fifth-container">
    <div class="counter-label">Nanana</div>
    <div class="live_nanana_count"></div>
  </div>

  <script>
    $(document).ready(function() {
      const key = 'AIzaSyC9X8DEYN_Csp8OU1aIzv_Kn3yYJBJGzkA';
      const videoIDs = [
        'Zx31bB2vMns',
        'wufUX5P2Ds8',
        'J1Ip2sC_lss',
        'QNV2DmBxChQ',
        'wJ6GCeSR4ss'
      ];

      var viewCountEl = document.querySelector('.live_view_count');
      var subCountEl = document.querySelector('.live_sub_count');
      var thirdCountEl = document.querySelector('.live_third_count');
      var kareraCountEl = document.querySelector('.live_karera_count');
      var nananaCountEl = document.querySelector('.live_nanana_count');

      if (!viewCountEl || !subCountEl || !thirdCountEl || !kareraCountEl || !nananaCountEl) {
        console.error('Some elements not found');
        return;
      }

      var viewCount = new Odometer({ el: viewCountEl, format: ',ddd', theme: 'default' });
      var subCount = new Odometer({ el: subCountEl, format: ',ddd', theme: 'default' });
      var thirdCount = new Odometer({ el: thirdCountEl, format: ',ddd', theme: 'default' });
      var kareraCount = new Odometer({ el: kareraCountEl, format: ',ddd', theme: 'default' });
      var nananaCount = new Odometer({ el: nananaCountEl, format: ',ddd', theme: 'default' });

      videoIDs.forEach((videoID, index) => {
        const odometer = [viewCount, subCount, thirdCount, kareraCount, nananaCount][index];
        setInterval(function () {
          getYoutubeVideoData(videoID, odometer);
        }, 4000);
      });

      function getYoutubeVideoData(videoID, odometer) {
        const apiUrl = `https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics&id=${videoID}&key=${key}`;

        $.getJSON(apiUrl)
          .done(function(result) {
            if (result && result.items && result.items.length > 0) {
              const videoData = result.items[0];
              const viewCount = videoData.statistics.viewCount;
              const title = videoData.snippet.title;

              if (!isNaN(viewCount)) {
                odometer.update(Number(viewCount));
              } else {
                console.error('Invalid viewCount:', viewCount);
                odometer.update('Error');
              }

              let containerId;
              if (odometer.el === viewCountEl) {
                containerId = 'view-container';
              } else if (odometer.el === subCountEl) {
                containerId = 'sub-container';
              } else if (odometer.el === thirdCountEl) {
                containerId = 'third-container';
              } else if (odometer.el === kareraCountEl) {
                containerId = 'fourth-container';
              } else if (odometer.el === nananaCountEl) {
                containerId = 'fifth-container';
              }

              if (containerId) {
                document.querySelector(`#${containerId} .counter-label`).textContent = title;
              } else {
                console.error('Container ID mapping not found for odometer:', odometer.el.className);
              }
            } else {
              console.error('No data found or unexpected response structure.');
              odometer.update('Error');
            }
          })
          .fail(function(jqXHR, textStatus, errorThrown) {
            console.error('Error fetching video data:', textStatus, errorThrown);
            odometer.update('Error');
          });
      }

      window.captureCounter = function(button) {
        const container = button.closest('.counter-container');

        if (!container) {
          console.error('Container not found');
          return;
        }

        const screenshotButton = container.querySelector('.screenshot-button');
        const shareButton = container.querySelector('.share-button');
        if (screenshotButton) {
          screenshotButton.style.display = 'none';
        }
        if (shareButton) {
          shareButton.style.display = 'none';
        }

        container.style.borderRadius = '0';
        container.style.overflow = 'visible';

        html2canvas(container, {
          scale: 2,
          useCORS: true,
          backgroundColor: null,
          scrollX: 0,
          scrollY: -window.scrollY,
          logging: true
        }).then(canvas => {
          container.style.borderRadius = '';
          container.style.overflow = '';

          if (screenshotButton) {
            screenshotButton.style.display = 'inline-block';
          }
          if (shareButton) {
            shareButton.style.display = 'inline-block';
          }

          const link = document.createElement('a');
          link.href = canvas.toDataURL('image/png');
          link.download = `screenshot_${container.id}.png`;
          link.click();
        }).catch(error => {
          console.error('Error capturing screenshot:', error);
        });
      };

      document.querySelectorAll('.share-button').forEach(button => {
        button.addEventListener('click', function() {
          const shareUrl = button.getAttribute('data-share-url');
          if (navigator.share) {
            navigator.share({
              title: 'BINI Music Videos Counter',
              url: shareUrl
            }).catch(console.error);
          } else {
            alert(`Please share this URL: ${shareUrl}`);
          }
        });
      });
    });
  </script>
</body>
</html>
